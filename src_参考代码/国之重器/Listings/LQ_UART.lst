C251 COMPILER V5.60.0,  LQ_UART                                                            23/07/22  05:23:46  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE LQ_UART
OBJECT MODULE PLACED IN .\Objects\LQ_UART.obj
COMPILER INVOKED BY: C:\Keil5\load\C251\BIN\C251.EXE user\LQ_UART.c LARGE INTR2 BROWSE INCDIR(.\user;.\user\Dianci) DEBU
                    -G PRINT(.\Listings\LQ_UART.lst) TABS(2) OBJECT(.\Objects\LQ_UART.obj) 

stmt  level    source

    1          /*LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL
    2          ¡¾Æ½    Ì¨¡¿±±¾©ÁúÇñÖÇÄÜ¿Æ¼¼STC16ºËÐÄ°å
    3          ¡¾ÐÞ    ¸Ä¡¿chiusir
    4          ¡¾E-mail  ¡¿chiusir@163.com
    5          ¡¾Èí¼þ°æ±¾¡¿V1.1 °æÈ¨ËùÓÐ£¬µ¥Î»Ê¹ÓÃÇëÏÈÁªÏµÊÚÈ¨
    6          ¡¾×îºó¸üÐÂ¡¿2021Äê1ÔÂ23ÈÕ
    7          ¡¾Ïà¹ØÐÅÏ¢²Î¿¼ÏÂÁÐµØÖ·¡¿
    8          ¡¾Íø    Õ¾¡¿http://www.lqist.cn
    9          ¡¾ÌÔ±¦µêÆÌ¡¿http://longqiu.taobao.com
   10          ------------------------------------------------
   11          ¡¾IDE¡¿STC16
   12          ¡¾Target ¡¿ C251Keil5.6¼°ÒÔÉÏ
   13          ¡¾SYS PLL¡¿ 30MHzÊ¹ÓÃÄÚ²¿¾§Õñ
   14          =================================================================
   15          STC16Ïà¹ØÅäÌ×ÊÓÆµ£º
   16          ÁúÇñ¿Æ¼¼BÕ¾ÍøÖ·£ºhttps://space.bilibili.com/95313236
   17          STC16»·¾³ÏÂÔØ²Î¿¼ÊÓÆµ£º https://www.bilibili.com/video/BV1gy4y1p7T1/
   18          STC16Ò»Ìå°å×Ó½éÉÜÊÓÆµ£º https://www.bilibili.com/video/BV1Jy4y1e7R4/
   19          =================================================================
   20          ÏÂÔØÊ±, Ñ¡ÔñÊ±ÖÓ 30MHZ (ÓÃ»§¿É×ÔÐÐÐÞ¸ÄÆµÂÊ).
   21          STC16F³õ´ÎÏÂÔØ:ÏÈÓÃIRCBND=0£¬ISP½çÃæÉèÖÃÎª24M£¬
   22          È»ºóIRCBND=0£¬ÏÂÔØÆµÂÊÎª30M£»
   23          »òÕßIRCBND=1£¬ÏÂÔØÆµÂÊÎª30M£»ºÃÓÃÎª×¼
   24          QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ*/
   25          #include "include.h"
   26          
   27          u8 Uart4_Receive;
   28          #define Baudrate1   (65536 - MAIN_Fosc / 115200 / 4)
   29          #define Baudrate4   (65536 - MAIN_Fosc / 115200 / 4)
   30          
   31          //========================================================================
   32          // º¯Êý: void UART1_int (void) interrupt UART1_VECTOR
   33          // ÃèÊö: UART1ÖÐ¶Ïº¯Êý¡£
   34          // ²ÎÊý: nine.
   35          // ·µ»Ø: none.
   36          // °æ±¾: VER1.0
   37          // ÈÕÆÚ: 2014-11-28
   38          // ±¸×¢: 
   39          //========================================================================
   40          void UART1_int (void) interrupt 4
   41          {
   42   1        if(RI)
   43   1        {
   44   2          RI = 0;    
   45   2        }
   46   1        
   47   1        if(TI)
   48   1        {
   49   2          TI = 0;    
   50   2        }
   51   1      }
   52          //========================================================================
   53          // º¯Êý: void UART4_int (void) interrupt UART4_VECTOR
   54          // ÃèÊö: UART4ÖÐ¶Ïº¯Êý¡£À¶ÑÀÒ£¿Ø¡£
   55          // ²ÎÊý: nine.
   56          // ·µ»Ø: none.
   57          // °æ±¾: VER1.0
   58          // ÈÕÆÚ: 2014-11-28
C251 COMPILER V5.60.0,  LQ_UART                                                            23/07/22  05:23:46  PAGE 2   

   59          // ±¸×¢: 
   60          //========================================================================
   61          extern short MotorDuty1, MotorDuty2,ServoDuty;          // µç»ú¶æ»úPMW±äÁ¿
   62          extern unsigned char Flag_Stop;
   63          extern short Velocity;
   64          int RX=0;
   65          int Go = 0;
   66          void UART4_int (void) interrupt 18
   67          {  
   68   1        static int uart_receive=0;//À¶ÑÀ½ÓÊÕÏà¹Ø±äÁ¿
   69   1        static u8 Flag_PID,i,j,Receive[50];                      
   70   1        static float Data;    
   71   1        if((S4CON & 0x01) != 0)                                  
   72   1          {                                                        
   73   2          S4CON &= ~0x01;                               //Clear Rx flag
   74   2                                                                       
   75   2          RX = S4BUF;      // ½ÓÊÕÊý¾Ý                                                            
   76   2          if(RX!=0&&Go==0)     
   77   2          {
   78   3            Go =1;        // Æô¶¯±êÖ¾Î»
   79   3          }      
   80   2      
   81   2          }                        
   82   1      
   83   1          if((S4CON & 0x02) != 0)
   84   1          {
   85   2              S4CON &= ~0x02;                           //Clear Tx flag        
   86   2          } 
   87   1      }
   88          //========================================================================
   89          // º¯Êý: SetTimer2Baudraye(u32 dat)
   90          // ÃèÊö: ÉèÖÃTimer2×ö²¨ÌØÂÊ·¢ÉúÆ÷¡£
   91          // ²ÎÊý: dat: Timer2µÄÖØ×°Öµ.
   92          // ·µ»Ø: none.
   93          // °æ±¾: VER1.0
   94          // ÈÕÆÚ: 2014-11-28
   95          // ±¸×¢: 
   96          //========================================================================
   97          void SetTimer2Baudraye(u32 dat)
   98          {
   99   1        AUXR &= ~(1<<4);                                         //Timer stop
  100   1        AUXR &= ~(1<<3);                                         //Timer2 set As Timer
  101   1        AUXR |=  (1<<2);                                         //Timer2 set as 1T mode
  102   1        T2H = (u8)(dat / 256);
  103   1        T2L = (u8)(dat % 256);
  104   1        IE2  &= ~(1<<2);                                         //½ûÖ¹ÖÐ¶Ï
  105   1        AUXR |=  (1<<4);                                         //Timer run enable
  106   1      }
  107          //========================================================================
  108          // º¯Êý: void   UART1_config(u16 tmr)
  109          // ÃèÊö: UART1³õÊ¼»¯º¯Êý¡£
  110          // ²ÎÊý: tmr: Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
  111          // ·µ»Ø: none.
  112          // °æ±¾: VER1.0
  113          // ÈÕÆÚ: 2014-11-28
  114          // ±¸×¢: 
  115          //========================================================================
  116          void UART1_config(u16 tmr)
  117          {  
  118   1        /*********** ²¨ÌØÂÊÊ¹ÓÃ¶¨Ê±Æ÷2 *****************/
  119   1        if(tmr == 2)
  120   1        {
  121   2          AUXR |= 0x01;                       //S1 tmr Use Timer2;
  122   2          SetTimer2Baudraye(Baudrate1);
  123   2        }
  124   1        /*********** ²¨ÌØÂÊÊ¹ÓÃ¶¨Ê±Æ÷1 *****************/
C251 COMPILER V5.60.0,  LQ_UART                                                            23/07/22  05:23:46  PAGE 3   

  125   1        else
  126   1        {
  127   2          TR1 = 0;
  128   2          AUXR &= ~0x01;                       //S1 tmr Use Timer1;
  129   2          AUXR |=  (1<<6);                     //Timer1 set as 1T mode
  130   2          TMOD &= ~(1<<6);                     //Timer1 set As Timer
  131   2          TMOD &= ~0x30;                       //Timer1_16bitAutoReload;
  132   2          TH1 = (u8)(Baudrate1 / 256);
  133   2          TL1 = (u8)(Baudrate1 % 256);
  134   2          ET1 = 0;                             //½ûÖ¹ÖÐ¶Ï
  135   2          INTCLKO &= ~0x02;                                         //²»Êä³öÊ±ÖÓ
  136   2          TR1  = 1;
  137   2        }
  138   1        /*************************************************/  
  139   1        SCON = (SCON & 0x3f) | 0x40;                                //UART1Ä£Ê½, 0x00: Í¬²½ÒÆÎ»Êä³ö, 0x40: 8Î»Ê
             -ý¾Ý,¿É±ä²¨ÌØÂÊ, 0x80: 9Î»Êý¾Ý,¹Ì¶¨²¨ÌØÂÊ, 0xc0: 9Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ
  140   1        //  PS  = 1;                                                    //¸ßÓÅÏÈ¼¶ÖÐ¶Ï
  141   1        ES  = 1;                                                    //ÔÊÐíÖÐ¶Ï
  142   1        REN = 1;                                                    //ÔÊÐí½ÓÊÕ
  143   1        P_SW1 &= 0x3f;
  144   1        //  P_SW1 |= 0x00;                                          //UART1 switch to, 0x00: P3.0 P3.1, 0x40: P
             -3.6 P3.7, 0x80: P1.6 P1.7, 0xC0: P4.3 P4.4
  145   1      }
  146          
  147          void UART4_config(u16 tmr)                                    // Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖ
             -µ: Ê¹ÓÃTimer4×ö²¨ÌØÂÊ.
  148          {
  149   1        if(tmr == 2)
  150   1        {
  151   2          SetTimer2Baudraye(Baudrate4);
  152   2          S4CON = 0x10;                                            //8Î»Êý¾Ý, Ê¹ÓÃTimer2×ö²¨ÌØÂÊ·¢ÉúÆ÷, ÔÊÐí½ÓÊ
             -Õ
  153   2        }
  154   1        else
  155   1        {
  156   2          S4CON = 0x50;                                            //8Î»Êý¾Ý, Ê¹ÓÃTimer4×ö²¨ÌØÂÊ·¢ÉúÆ÷, ÔÊÐí½ÓÊ
             -Õ
  157   2          T4H = (Baudrate4) / 256;
  158   2          T4L = (Baudrate4) % 256;
  159   2          T4T3M = 0xA0;
  160   2        }
  161   1        IE2 |= 0x10;                                               //ÔÊÐíUART4ÖÐ¶Ï
  162   1        //    P_SW2 &= ~0x04;                                      //UART4 switch bit2 to: 0: P0.2 P0.3
  163   1        P_SW2 |= 0x04;                                             //UART4 switch bit2 to: 1: P5.2 P5.3
  164   1      }
  165          
  166          /*************************************************************************
  167          *  º¯ÊýÃû³Æ£ºvoid UART_PutChar(UART_t  uratn, char ch)
  168          *  ¹¦ÄÜËµÃ÷£ºUART·¢ËÍ×Ö½Úº¯Êý,Ê¹ÓÃÇ°ÇëÏÈ³õÊ¼»¯¶ÔÓ¦´®¿Ú
  169          *  ²ÎÊýËµÃ÷£ºuratn £º UART0 - UART3/ ch    £º Òª´òÓ¡µÄ×Ö·û
  170          *  º¯Êý·µ»Ø£ºÎÞ
  171          *  ÐÞ¸ÄÊ±¼ä£º2020Äê3ÔÂ10ÈÕ
  172          *  ±¸    ×¢£ºUART_PutChar(UART0, 'a');  //´òÓ¡×Ö·ûa
  173          *************************************************************************/
  174          void UART1_PutChar(char ch)
  175          {
  176   1        SBUF = ch;    
  177   1      }
  178          void UART4_PutChar(char ch)
  179          {
  180   1        
  181   1        S4BUF = ch;    
  182   1      }
  183          
  184          /*************************************************************************
  185          *  º¯ÊýÃû³Æ£ºvoid UART_PutStr(UART_t  uratn, char *st)
C251 COMPILER V5.60.0,  LQ_UART                                                            23/07/22  05:23:46  PAGE 4   

  186          *  ¹¦ÄÜËµÃ÷£ºUART·¢ËÍ×Ö·û´®º¯Êý(Óö NULL Í£Ö¹·¢ËÍ),Ê¹ÓÃÇ°ÇëÏÈ³õÊ¼»¯¶ÔÓ¦´®¿Ú
  187          *  ²ÎÊýËµÃ÷£ºuratn £º UART0 - UART3/ str   £º Òª´òÓ¡µÄ×Ö·û´®µØÖ·
  188          *  º¯Êý·µ»Ø£ºÎÞ
  189          *  ÐÞ¸ÄÊ±¼ä£º2020Äê3ÔÂ10ÈÕ
  190          *  ±¸    ×¢£ºUART_PutStr(UART3, "123456789"); //·¢ËÍ9¸ö×Ö½Ú
  191          *************************************************************************/
  192          void UART1_PutStr(char *st)
  193          {
  194   1        while(*st)
  195   1        {
  196   2          UART1_PutChar(*st++);
  197   2        }
  198   1      }
  199          void UART4_PutStr(char *st)
  200          {
  201   1        while(*st)
  202   1        {
  203   2          UART4_PutChar(*st++);
  204   2        }
  205   1      }
  206          
  207          /*************************************************************************
  208          *  º¯ÊýÃû³Æ£ºvoid UART4_PutBuff(unsigned char *buff, unsigned long len)
  209          *  ¹¦ÄÜËµÃ÷£ºUART·¢ËÍ×Ö½Úº¯Êý,Ê¹ÓÃÇ°ÇëÏÈ³õÊ¼»¯¶ÔÓ¦´®¿Ú
  210          *  ²ÎÊýËµÃ÷£º
  211          * @param    buff  £º Òª´òÓ¡µÄ×Ö·û´®µØÖ·
  212          * @param    len   £º Òª´òÓ¡µÄ³¤¶È
  213          *  º¯Êý·µ»Ø£ºÎÞ
  214          *  ÐÞ¸ÄÊ±¼ä£º2020Äê3ÔÂ10ÈÕ
  215          *  ±¸    ×¢£ºUART4_PutBuff("123456789",5);//Êµ¼Ê·¢ËÍ5¸ö×Ö½Ú¡®1¡¯¡®2¡¯¡®3¡¯¡®4¡¯¡®5¡¯
  216          *************************************************************************/
  217          void UART4_PutBuff(unsigned char *buff, unsigned long len)
  218          {
  219   1        while(len--)
  220   1        {
  221   2          UART4_PutChar(*buff);
  222   2          buff++;
  223   2        }
  224   1      }
  225          
  226          /*************************************************************************
  227          *  º¯ÊýÃû³Æ£ºchar UART_GetChar(UART_t  uratn)
  228          *  ¹¦ÄÜËµÃ÷£ºUART¶ÁÈ¡×Ö½Ú Ê¹ÓÃÇ°ÇëÏÈ³õÊ¼»¯¶ÔÓ¦´®¿Ú µ÷ÓÃÇ°ÇëÈ·ÈÏÓÐ½ÓÊÕµ½Êý¾Ý ·ñÔò»áµÈ´ýÊý¾Ýµ½À´
  229          *  ²ÎÊýËµÃ÷£ºuratn £º UART0 - UART3
  230          *  º¯Êý·µ»Ø£º¶ÁÈ¡×Ö½Ú
  231          *  ÐÞ¸ÄÊ±¼ä£º2020Äê3ÔÂ10ÈÕ
  232          *  ±¸    ×¢£ºUART_GetChar(UART3); //½ÓÊÕÒ»¸ö×Ö·û
  233          *************************************************************************/
  234          char UART1_GetChar(void)
  235          {  
  236   1        return (SBUF);
  237   1      }
  238          char UART4_GetChar(void)
  239          {  
  240   1        return (S4BUF);
  241   1      }
  242          
  243          //


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       330     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
C251 COMPILER V5.60.0,  LQ_UART                                                            23/07/22  05:23:46  PAGE 5   

  xdata size           =        64          4
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        21     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
